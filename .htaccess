# -------------------------------------------------------
# Canonical www redirect
# -------------------------------------------------------
Options +FollowSymLinks
RewriteEngine On

RewriteCond %{HTTP_HOST} ^maxdesign\.com\.au [NC]
RewriteRule ^(.*)$ https://www.maxdesign.com.au/$1 [L,R=301]

# -------------------------------------------------------
# Custom 404
# -------------------------------------------------------
ErrorDocument 404 /404.html

# -------------------------------------------------------
# FEEDS (all variants → feed.xml)
# -------------------------------------------------------
RedirectMatch 301 ^/(.+/)?(feed|rss|atom)(\.xml)?/?$ /feed.xml

# -------------------------------------------------------
# RETIRED LAYOUT DEMOS
# Entire folders → /articles/index.html
# IMPORTANT: must appear BEFORE rewrite rules below
# -------------------------------------------------------
RedirectMatch 301 ^/css-layouts(/.*)?$ /articles/index.html
RedirectMatch 301 ^/liquid(/.*)?$ /articles/index.html

# -------------------------------------------------------
# EXTENSION NORMALISATION (.cfm, .htm → .html)
# -------------------------------------------------------
RewriteRule ^(.+)\.(cfm|htm)$ /$1.html [L,R=301]

# -------------------------------------------------------
# TRAILING SLASH NORMALISATION FOR HTML CONTENT
# /foo/ → /foo.html  (if file exists)
# -------------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !\.html$
RewriteRule ^(.+)/$ /$1.html [L,R=301]

# -------------------------------------------------------
# OLD WORDPRESS BLOG URLS
# /YYYY/MM/DD/slug/ → /articles/slug.html
# -------------------------------------------------------
RewriteRule ^([0-9]{4})/[0-9]{2}/[0-9]{2}/(.+)/?$ /articles/$2.html [L,R=301]

# -------------------------------------------------------
# COLLAPSE presentation / news / articles prefix variations
# /presentation/foo → /articles/foo.html
# /news/foo → /articles/foo.html
# /articles/foo → /articles/foo.html (ensures correct filename)
# -------------------------------------------------------
RewriteRule ^(presentation|news|articles)/([^/]+)/?$ /articles/$2.html [L,R=301]

# -------------------------------------------------------
# CONTACT + BOOK PAGES
# -------------------------------------------------------
Redirect 301 /contact /contact-us/index.html
Redirect 301 /contact.cfm /contact-us/index.html
Redirect 301 /contact.htm /contact-us/index.html

Redirect 301 /book /book/index.html
Redirect 301 /book.cfm /book/index.html
Redirect 301 /book.htm /book/index.html

# -------------------------------------------------------
# ABOUT PAGES
# -------------------------------------------------------
Redirect 301 /about_russ.cfm /about/russweakley/index.html
Redirect 301 /about.php /about/index.html
